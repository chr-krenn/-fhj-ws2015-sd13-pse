<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">
<h:body>
	<ui:composition>
		<p:toolbar rendered="#{loginController.isLoggedIn}">
			<f:facet name="left">
				<h:form>
					<p:button value="Home" icon="ui-icon-home" href="/protected/TestLoggedIn.jsf"/>
	            	<p:button value="Communities" icon="ui-icon-pencil" href="/protected/Communities.jsf"/>
	            	<p:button value="Personen" href="/protected/UserList.jsf"/>
	            	<p:button value="Services" icon="ui-icon-help" href="/protected/Services.jsf" />
	            	<p:button value="Administration" icon="ui-icon-gear" href="/protected/AdminView.jsf" />
	            	<span class="ui-separator">
	                	<span class="ui-icon ui-icon-grip-dotted-vertical" />
	            	</span>
					<p:splitButton value="#{loginController.loggedInUsername}"
						icon="ui-icon-person">
						<p:menuitem>
							<h:link outcome="/protected/User.jsf"
								styleClass="ui-menuitem-link ui-corner-left">
								<f:param name="userName"
									value="#{loginController.loggedInUsername}" />
								<f:param name="mode" value="view" />
								<span class="ui-menuitem-icon ui-icon ui-icon-home"></span>
								<span class="ui-menuitem-text">Startseite</span>
							</h:link>
						</p:menuitem>
						<p:menuitem>
							<h:link outcome="/protected/User.jsf"
								styleClass="ui-menuitem-link ui-corner-all">
								<f:param name="userName"
									value="#{loginController.loggedInUsername}" />
								<f:param name="mode" value="edit" />
								<span class="ui-menuitem-icon ui-icon ui-icon-pencil"></span>
								<span class="ui-menuitem-text">Profil bearbeiten</span>
							</h:link>
						</p:menuitem>
						<p:menuitem value="Passwort ändern" onclick="PF('dlgpwc').show()"
							icon="ui-icon-key" />
						<p:menuitem value="Abmelden"
							actionListener="#{loginController.logout}"
							icon="ui-icon-arrowthickstop-1-e" />
					</p:splitButton>
            	</h:form>
			</f:facet>
			<f:facet name="right">
				<h:form id="searchform">
					<p:inputText value="#{userSearchController.search}" />
					<p:commandButton process="@parent"
						action="#{userSearchController.doSearch}" value="Suche"
						icon="ui-icon-search">
						<f:param name="search" value="#{userSearchController.search}" />
					</p:commandButton>
				</h:form>
			</f:facet>
		</p:toolbar>


		<p:growl id="growlpwc" sticky="false" showDetail="true" life="5000" />

		<p:dialog header="Password ändern" widgetVar="dlgpwc"
			resizeable="false">
			<h:panelGrid columns="2" cellpadding="5">

				<h:outputLabel for="oldPassword" value="Altes Passwort:" />
				<p:password id="oldPassword" value="#{loginController.password}"
					required="true" label="Altes Passwort" />

				<h:outputLabel for="newPassword" value="Neues Passwort:" />
				<p:password id="newPassword" value="#{loginController.passwordNew}"
					required="true" label="Neues Passwort" />

				<h:outputLabel for="newPasswordConfirmation"
					value="Neues Passwort erneut eingeben:" />
				<p:password id="newPasswordConfirmation"
					value="#{loginController.passwordNewConfirmation}" required="true"
					label="Neues Passwort erneut eingeben" />

				<f:facet name="footer">
					<p:commandButton value="Bestätigung" update="growlpwc"
						actionListener="#{loginController.changePasswort}"
						oncomplete="handlePasswordChangeResult(xhr,status,args)" />
					<p:commandButton value="Abbrechen" update="growlpwc"
						onclick="PF('dlgpwc').hide();" />
				</f:facet>
			</h:panelGrid>
		</p:dialog>
		<script type="text/javascript">
			function handlePasswordChangeResult(xhr, status, args) {
				if (!args.passwordChanged) {
					PF('dlgpwc').jq.effect("shake", {
						times : 5
					}, 100);
				} else {
					PF('dlgpwc').hide();
				}
			}
		</script>
	</ui:composition>
</h:body>
</html>
